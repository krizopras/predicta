<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PREDICTA AI v6.0 - Profesyonel Futbol Tahmin Sistemi</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    * {margin:0;padding:0;box-sizing:border-box;}
    body {
      font-family: 'Inter', sans-serif;
      background: linear-gradient(135deg,#0f2027,#203a43,#2c5364);
      color:#fff; min-height:100vh;
    }
    .header {text-align:center; padding:40px 20px; background:rgba(255,255,255,0.05);backdrop-filter:blur(10px);}
    .header h1 {font-size:3rem; font-weight:700; background:linear-gradient(45deg,#ffd700,#ff9800);
      -webkit-background-clip:text; -webkit-text-fill-color:transparent;}
    .tagline {color:#cfd8dc; margin-top:8px;}
    .version-badge {margin-top:10px;display:inline-block;padding:6px 14px;border-radius:20px;background:rgba(255,215,0,0.15);color:#ffd700;font-size:0.85rem;}
    .container {max-width:1400px; margin:30px auto; padding:0 20px; display:grid; grid-template-columns:280px 1fr; gap:25px;}
    .sidebar {background:rgba(255,255,255,0.08);backdrop-filter:blur(12px);border-radius:16px; padding:20px;}
    .sidebar-title {font-size:1.2rem;font-weight:600;color:#ffd700;margin-bottom:15px;}
    .league-list {max-height:calc(100vh - 200px);overflow-y:auto;}
    .league-item {padding:12px 15px;margin-bottom:10px;border-radius:12px;display:flex;justify-content:space-between;align-items:center;background:rgba(255,255,255,0.04);cursor:pointer;transition:all .3s ease;}
    .league-item:hover {background:rgba(255,215,0,0.15);transform:translateX(4px);}
    .league-item.active {background:linear-gradient(135deg,#ffd70033,#ff980033);border-left:4px solid #ffd700;}
    .league-name {font-size:0.95rem;}
    .league-count {background:rgba(255,215,0,0.25);padding:2px 8px;border-radius:10px;font-size:0.75rem;color:#ffd700;}
    .stats-container {display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:20px;margin-bottom:25px;}
    .stat-box {background:rgba(255,255,255,0.07);border-radius:14px;padding:20px;text-align:center;}
    .stat-value {font-size:2.2rem;font-weight:700;color:#ffd700;margin-bottom:8px;}
    .stat-label {color:#cfd8dc;font-size:0.9rem;}
    .controls {display:flex;flex-wrap:wrap;gap:12px;margin-bottom:20px;}
    .control-label {font-weight:600;color:#ffd700;}
    .filter-btn,.sort-btn,.action-btn {padding:10px 18px;border:none;border-radius:8px;background:rgba(255,255,255,0.08);color:#fff;font-weight:600;cursor:pointer;transition:all .3s;}
    .filter-btn:hover,.sort-btn:hover,.action-btn:hover {background:rgba(255,215,0,0.2);}
    .filter-btn.active,.sort-btn.active,.action-btn.active {background:linear-gradient(135deg,#ffd700,#ff9800);color:#1a237e;}
    .action-btn.train {background:linear-gradient(135deg,#00b894,#55efc4);color:#000;}
    .action-btn.refresh {background:linear-gradient(135deg,#74b9ff,#0984e3);color:#000;}
    .action-btn:disabled {opacity:0.6;cursor:not-allowed;}
    .main-content {background:rgba(255,255,255,0.05);border-radius:16px;backdrop-filter:blur(10px);padding:20px;}
    .loading {text-align:center;padding:40px;color:#ffd700;}

    /* Sistem Durumu */
    .system-status {background:rgba(255,255,255,0.05);border-radius:12px;padding:15px;margin-bottom:20px;}
    .status-item {display:flex;justify-content:space-between;margin-bottom:8px;font-size:0.9rem;}
    .status-label {color:#cfd8dc;}
    .status-value {color:#ffd700;font-weight:600;}
    .status-value.healthy {color:#00b894;}
    .status-value.warning {color:#fdcb6e;}
    .status-value.error {color:#ff7675;}

    /* Eğitim Durumu */
    .training-status {background:linear-gradient(135deg,#ff6b6b33,#ee5a2433);padding:15px;border-radius:12px;margin-bottom:20px;display:none;}
    .training-progress {margin:10px 0;}
    .progress-bar {width:100%;height:20px;background:rgba(255,255,255,0.1);border-radius:10px;overflow:hidden;}
    .progress-fill {height:100%;background:linear-gradient(135deg,#00b894,#55efc4);transition:width 0.5s ease;border-radius:10px;}
    .training-complete {background:linear-gradient(135deg,#00b89433,#55efc433);color:#00b894;}

    /* Maç Tablosu - Responsive İyileştirmeler */
    .league-section {margin-bottom:35px;}
    .league-header {
      background:linear-gradient(135deg,rgba(255,215,0,0.2),rgba(255,152,0,0.2));
      padding:15px 20px;border-radius:12px;margin-bottom:15px;
      display:flex;justify-content:space-between;align-items:center;
      border-left:5px solid #ffd700;
    }
    .league-title {font-size:1.3rem;font-weight:700;color:#ffd700;}
    .league-match-count {background:rgba(255,255,255,0.2);padding:5px 12px;border-radius:20px;font-size:0.9rem;}
    
    .match-table-container {
      background:rgba(255,255,255,0.03);
      border-radius:12px;
      overflow:hidden;
      overflow-x: auto; /* Yatay kaydırma için */
    }
    table {width:100%;border-collapse:collapse;min-width:800px;} /* Minimum genişlik */
    thead {background:rgba(255,215,0,0.1);border-bottom:2px solid rgba(255,215,0,0.3);}
    th {padding:12px;text-align:center;color:#ffd700;font-size:0.9rem;font-weight:600;}
    th:nth-child(2) {text-align:left;}
    tbody tr {border-bottom:1px solid rgba(255,255,255,0.05);transition:background 0.2s;}
    tbody tr:hover {background:rgba(255,215,0,0.05);}
    td {padding:15px 12px;}
    
    .match-time {color:#b0bec5;font-size:0.85rem;text-align:center;line-height:1.4;white-space:nowrap;}
    .match-info {text-align:left;min-width:200px;}
    .home-team {font-weight:600;color:#fff;margin-bottom:4px;font-size:1rem;}
    .away-team {color:#90a4ae;font-size:0.9rem;}
    
    .odds-cell {text-align:center;}
    .odds-box {
      display:inline-block;
      padding:10px 18px;
      border-radius:8px;
      font-weight:700;
      font-size:1.05rem;
      background:rgba(255,255,255,0.08);
      color:#fff;
      transition:all 0.2s;
      cursor:pointer;
      min-width:60px;
      position:relative;
    }
    .odds-box.predicted {
      background:linear-gradient(135deg,#ffd700,#ff9800);
      color:#000;
      border:2px solid #ffd700;
      box-shadow:0 0 15px rgba(255,215,0,0.4);
      animation:pulse 2s infinite;
    }
    
    /* Değerli Bahis Badge */
    .value-bet-badge {
      position:absolute;
      top:-8px;
      right:-8px;
      background:linear-gradient(135deg,#00b894,#55efc4);
      color:#000;
      padding:2px 6px;
      border-radius:10px;
      font-size:0.7rem;
      font-weight:bold;
      z-index:2;
    }
    
    /* Güven Göstergesi */
    .confidence-bar {
      width:100%;
      height:4px;
      background:rgba(255,255,255,0.1);
      border-radius:2px;
      margin-top:5px;
      overflow:hidden;
    }
    
    .confidence-fill {
      height:100%;
      border-radius:2px;
      transition:width 0.3s ease;
    }
    
    .confidence-high {background:linear-gradient(90deg,#00b894,#55efc4);}
    .confidence-medium {background:linear-gradient(90deg,#fdcb6e,#e17055);}
    .confidence-low {background:linear-gradient(90deg,#ff7675,#d63031);}
    
    /* Tahmin Detayları */
    .prediction-details {
      font-size:0.8rem;
      color:#b0bec5;
      margin-top:5px;
    }
    
    .risk-high {color:#ff7675;}
    .risk-medium {color:#fdcb6e;}
    .risk-low {color:#00b894;}

    /* Pagination */
    .pagination {
      display:flex;
      justify-content:center;
      align-items:center;
      gap:10px;
      margin-top:20px;
      padding:15px;
    }
    
    .page-btn {
      padding:8px 16px;
      border:none;
      border-radius:6px;
      background:rgba(255,255,255,0.08);
      color:#fff;
      cursor:pointer;
      transition:all 0.3s;
    }
    
    .page-btn:hover {
      background:rgba(255,215,0,0.2);
    }
    
    .page-btn.active {
      background:linear-gradient(135deg,#ffd700,#ff9800);
      color:#000;
    }
    
    .page-btn:disabled {
      opacity:0.5;
      cursor:not-allowed;
    }
    
    .page-info {
      color:#cfd8dc;
      font-size:0.9rem;
    }

    /* Hata Mesajları */
    .error-container {
      text-align:center;
      padding:40px;
      background:rgba(255,118,117,0.1);
      border-radius:12px;
      margin:20px 0;
    }
    
    .error-title {
      color:#ff7675;
      font-size:1.5rem;
      margin-bottom:15px;
    }
    
    .error-details {
      color:#cfd8dc;
      margin-bottom:20px;
      font-size:0.9rem;
    }

    /* Responsive İyileştirmeler */
    @media (max-width: 1024px) {
      .container {grid-template-columns:1fr;gap:20px;}
      .sidebar {max-height:300px;}
      table {font-size:0.85rem;min-width:600px;}
      .odds-box {padding:8px 12px;font-size:0.95rem;min-width:50px;}
      .home-team {font-size:0.9rem;}
      .away-team {font-size:0.8rem;}
      .controls {flex-direction:column;}
      .match-info {min-width:150px;}
    }

    @media (max-width: 768px) {
      .header h1 {font-size:2rem;}
      .stats-container {grid-template-columns:repeat(2,1fr);}
      .container {padding:0 15px;}
      table {min-width:500px;}
      .match-time {font-size:0.75rem;}
    }

    @media (max-width: 480px) {
      .header {padding:20px 15px;}
      .header h1 {font-size:1.5rem;}
      .stats-container {grid-template-columns:1fr;}
      .controls {gap:8px;}
      .filter-btn, .sort-btn, .action-btn {padding:8px 12px;font-size:0.85rem;}
    }

    @keyframes pulse {
      0%, 100% {box-shadow:0 0 15px rgba(255,215,0,0.4);}
      50% {box-shadow:0 0 25px rgba(255,215,0,0.6);}
    }

    /* Yükleme Animasyonu */
    .loading-spinner {
      display:inline-block;
      width:20px;
      height:20px;
      border:3px solid rgba(255,255,255,0.3);
      border-radius:50%;
      border-top-color:#ffd700;
      animation:spin 1s ease-in-out infinite;
      margin-right:10px;
    }

    @keyframes spin {
      to {transform:rotate(360deg);}
    }
  </style>
</head>
<body>
<header class="header">
  <h1>PREDICTA AI v6.0</h1>
  <div class="tagline">Entegre Futbol Tahmin Sistemi</div>
  <div class="version-badge">Geçmiş Veri + Canlı Analiz</div>
</header>

<div class="container">
  <aside class="sidebar">
    <div class="sidebar-title">📊 Sistem Durumu</div>
    <div class="system-status">
      <div class="status-item">
        <span class="status-label">API Durumu:</span>
        <span class="status-value healthy" id="api-status">Çevrimiçi</span>
      </div>
      <div class="status-item">
        <span class="status-label">Model:</span>
        <span class="status-value" id="model-status">Aktif</span>
      </div>
      <div class="status-item">
        <span class="status-label">Son Güncelleme:</span>
        <span class="status-value" id="last-update">-</span>
      </div>
      <div class="status-item">
        <span class="status-label">Önbellek:</span>
        <span class="status-value" id="cache-status">0 maç</span>
      </div>
    </div>

    <div class="sidebar-title">🔄 İşlemler</div>
    <div style="display:flex;flex-direction:column;gap:10px;margin-bottom:20px;">
      <button class="action-btn refresh" onclick="refreshData()" id="refresh-btn">
        🔄 Verileri Yenile
      </button>
      <button class="action-btn train" onclick="startTraining()" id="train-btn">
        🤖 Modeli Eğit
      </button>
    </div>

    <div class="sidebar-title">📋 Ülkeler</div>
    <div id="league-list" class="league-list">
      <div class="loading">Ülkeler yükleniyor...</div>
    </div>
  </aside>

  <main>
    <!-- Eğitim Durumu -->
    <div id="training-status" class="training-status">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;">
        <strong>🤖 Model Eğitiliyor</strong>
        <span id="training-progress-text">0%</span>
      </div>
      <div class="training-progress">
        <div class="progress-bar">
          <div class="progress-fill" id="progress-fill" style="width: 0%"></div>
        </div>
      </div>
      <div id="training-message">Geçmiş veriler işleniyor...</div>
    </div>

    <!-- İstatistikler -->
    <div class="stats-container">
      <div class="stat-box">
        <div class="stat-value" id="total-matches">0</div>
        <div class="stat-label">Toplam Maç</div>
      </div>
      <div class="stat-box">
        <div class="stat-value" id="high-confidence">0</div>
        <div class="stat-label">Yüksek Güven</div>
      </div>
      <div class="stat-box">
        <div class="stat-value" id="value-bets">0</div>
        <div class="stat-label">Değerli Bahis</div>
      </div>
      <div class="stat-box">
        <div class="stat-value" id="model-accuracy">%85</div>
        <div class="stat-label">Model Doğruluğu</div>
      </div>
    </div>

    <!-- Kontroller -->
    <div class="controls">
      <span class="control-label">Filtrele:</span>
      <button class="filter-btn active" onclick="filterMatches('all', event)">Tümü</button>
      <button class="filter-btn" onclick="filterMatches('high-confidence', event)">Yüksek Güven</button>
      <button class="filter-btn" onclick="filterMatches('value-bets', event)">Değerli Bahisler</button>
      <button class="filter-btn" onclick="filterMatches('strong-bets', event)">Güçlü Tahminler</button>
      
      <span class="control-label" style="margin-left:auto;">Sırala:</span>
      <button class="sort-btn active" onclick="sortMatches('confidence', event)">Güvene Göre</button>
      <button class="sort-btn" onclick="sortMatches('time', event)">Zamana Göre</button>
      <button class="sort-btn" onclick="sortMatches('value', event)">Değere Göre</button>
    </div>

    <!-- Ana İçerik -->
    <div class="main-content">
      <div id="content-area" class="loading">
        <div class="loading-spinner"></div>AI tahmin motoru başlatılıyor...
      </div>
      
      <!-- Pagination -->
      <div id="pagination" class="pagination" style="display:none;">
        <button class="page-btn" onclick="changePage(-1)" id="prev-btn">← Önceki</button>
        <span class="page-info" id="page-info">Sayfa 1 / 1</span>
        <button class="page-btn" onclick="changePage(1)" id="next-btn">Sonraki →</button>
      </div>
    </div>
  </main>
</div>

<script>
  // Global değişkenler
  let allMatches = [];
  let allPredictions = [];
  let currentFilter = 'all';
  let currentSort = 'confidence';
  let selectedLeague = 'all';
  let currentPage = 1;
  const matchesPerPage = 20;
  const API_BASE_URL = window.location.origin;

  // Ülke ve takım eşleştirmesi
  const countryTeams = {
    "🇹🇷 Türkiye": ["Fenerbahçe", "Galatasaray", "Beşiktaş", "Trabzonspor", "Başakşehir", "Sivasspor", "Alanyaspor", "Kayserispor", "Gençlerbirliği", "Ankaragücü", "Konyaspor", "Kasımpaşa", "Hatayspor", "Giresunspor", "Ümraniyespor", "İstanbulspor", "Gaziantep", "Adana Demirspor", "Antalyaspor", "Fatih Karagümrük", "Pendikspor", "Samsunspor", "Çaykur Rizespor", "Eyüpspor", "Bodrum", "Göztepe", "Sakaryaspor", "Kocaelispor", "Boluspor", "Erzurumspor", "Keçiörengücü", "Bandırmaspor", "Manisa", "Ümraniye", "Tuzlaspor", "Ankaragücü", "Altay", "Giresun", "Gençlerbirliği", "Menemen", "Şanlıurfaspor"],
    
    "🏴󠁧󠁢󠁥󠁮󠁧󠁿 İngiltere": [
      "Arsenal", "Chelsea", "Liverpool", "Manchester City", "Manchester United", "Tottenham", "Newcastle", "Brighton", "West Ham", "Aston Villa", "Crystal Palace", "Fulham", "Bournemouth", "Wolves", "Brentford", "Nottingham Forest", "Everton", "Leicester", "Ipswich", "Southampton",
      "Leeds", "Sheffield United", "Burnley", "Luton", "Middlesbrough", "Coventry", "Norwich", "Watford", "Millwall", "Bristol City", "QPR", "Preston", "Swansea", "Blackburn", "Hull", "Stoke", "Cardiff", "Plymouth", "Sheffield Wednesday", "Derby", "Portsmouth", "Oxford United", "Sunderland", "West Brom"
    ],
    
    "🇮🇹 İtalya": [
      "Juventus", "Inter", "Milan", "Napoli", "Roma", "Lazio", "Atalanta", "Fiorentina", "Torino", "Bologna", "Monza", "Udinese", "Empoli", "Lecce", "Genoa", "Cagliari", "Verona", "Parma", "Como", "Venezia",
      "Sassuolo", "Salernitana", "Frosinone", "Brescia", "Palermo", "Cremonese", "Sampdoria", "Catanzaro", "Reggiana", "Spezia", "Pisa", "Bari", "Modena", "Cittadella", "Cosenza", "Juve Stabia", "Mantova", "Cesena", "Sudtirol", "Carrarese"
    ],
    
    "🇪🇸 İspanya": [
      "Real Madrid", "Barcelona", "Atletico Madrid", "Sevilla", "Valencia", "Villarreal", "Real Betis", "Athletic Bilbao", "Real Sociedad", "Celta Vigo", "Mallorca", "Osasuna", "Getafe", "Rayo Vallecano", "Las Palmas", "Girona", "Alaves", "Leganes", "Valladolid", "Espanyol",
      "Granada", "Almeria", "Cadiz", "Elche", "Levante", "Eibar", "Sporting Gijon", "Real Zaragoza", "Racing Santander", "Real Oviedo", "Malaga", "Tenerife", "Huesca", "Burgos", "Cartagena", "Eldense", "Mirandes", "Racing Ferrol", "Albacete", "Castellon", "Cordoba", "Deportivo"
    ],
    
    "🇩🇪 Almanya": [
      "Bayern Munich", "Borussia Dortmund", "RB Leipzig", "Bayer Leverkusen", "Union Berlin", "Freiburg", "Eintracht Frankfurt", "Wolfsburg", "Borussia Mönchengladbach", "Mainz", "Stuttgart", "Hoffenheim", "Augsburg", "Werder Bremen", "Bochum", "Heidenheim", "St. Pauli", "Holstein Kiel",
      "Cologne", "Hamburg", "Hertha Berlin", "Fortuna Dusseldorf", "Schalke", "Hannover", "Paderborn", "Kaiserslautern", "Magdeburg", "Nurnberg", "Karlsruhe", "Braunschweig", "Elversberg", "Greuther Furth", "Darmstadt", "Regensburg", "Ulm", "Preussen Munster"
    ],
    
    "🇫🇷 Fransa": [
      "Paris Saint-Germain", "Marseille", "Monaco", "Lyon", "Lille", "Nice", "Lens", "Rennes", "Reims", "Strasbourg", "Brest", "Toulouse", "Nantes", "Montpellier", "Auxerre", "Angers", "Le Havre", "Saint-Etienne",
      "Paris FC", "Lorient", "Metz", "Troyes", "Clermont Foot", "Ajaccio", "Bastia", "Dunkerque", "Guingamp", "Laval", "Grenoble", "Amiens", "Rodez", "Pau", "Caen", "Martigues", "Red Star", "Valenciennes"
    ],
    
    "🇳🇱 Hollanda": [
      "Ajax", "PSV", "Feyenoord", "AZ Alkmaar", "Twente", "Utrecht", "Vitesse", "Heerenveen", "Groningen", "Sparta Rotterdam", "Fortuna Sittard", "Heracles", "PEC Zwolle", "RKC Waalwijk", "Go Ahead Eagles", "Almere City", "Willem II", "NAC Breda",
      "Excelsior", "Cambuur", "Volendam", "Den Bosch", "Dordrecht", "Telstar", "Emmen", "MVV", "Jong Ajax", "Jong PSV", "Jong Utrecht", "De Graafschap", "Roda JC", "ADO Den Haag", "Helmond Sport", "TOP Oss", "VVV-Venlo", "Maastricht"
    ],
    
    "🇵🇹 Portekiz": [
      "Benfica", "Porto", "Sporting CP", "Braga", "Vitoria Guimaraes", "Casa Pia", "Estoril", "Boavista", "Famalicao", "Rio Ave", "Santa Clara", "Arouca", "Gil Vicente", "Estrela", "Farense", "Moreirense", "Nacional", "AVS",
      "Vizela", "Chaves", "Portimonense", "Maritimo", "Paços de Ferreira", "Tondela", "Academico Viseu", "Felgueiras", "Leixoes", "Penafiel", "Mafra", "Feirense", "Benfica B", "Porto B", "Alverca", "Torreense", "Oliveira", "União de Leiria"
    ]
  };

  // Tarih formatını düzenle
  function formatDate(dateString) {
    if (!dateString || dateString === 'TBA') return 'TBA';
    
    try {
      // YYYY-MM-DD formatını DD/MM formatına çevir
      const [year, month, day] = dateString.split('-');
      if (year && month && day) {
        return `${day}/${month}`;
      }
      return dateString;
    } catch (e) {
      return dateString;
    }
  }

  // Saat formatını düzenle
  function formatTime(timeString) {
    if (!timeString || timeString === '20:00') return timeString || '20:00';
    
    // Saat:dd formatını koru
    return timeString;
  }

  // Ülke tespiti
  function detectCountryByTeamNames(homeTeam, awayTeam) {
    for (const [country, teams] of Object.entries(countryTeams)) {
      const homeInCountry = teams.some(team => 
        homeTeam.toLowerCase().includes(team.toLowerCase())
      );
      const awayInCountry = teams.some(team => 
        awayTeam.toLowerCase().includes(team.toLowerCase())
      );
      
      if (homeInCountry && awayInCountry) {
        return country;
      } else if (homeInCountry || awayInCountry) {
        return country;
      }
    }
    return "🌍 Diğer Ülkeler";
  }

  // Sistem durumunu yükle
  async function loadSystemStatus() {
    try {
      const response = await fetch(`${API_BASE_URL}/api/system/health`);
      const data = await response.json();
      
      document.getElementById('api-status').textContent = data.status === 'healthy' ? 'Çevrimiçi' : 'Çevrimdışı';
      document.getElementById('api-status').className = data.status === 'healthy' ? 'status-value healthy' : 'status-value error';
      document.getElementById('model-status').textContent = data.engine;
      document.getElementById('cache-status').textContent = `${data.matches_cached} maç`;
      document.getElementById('last-update').textContent = new Date().toLocaleTimeString('tr-TR');
      
    } catch (error) {
      console.error('Sistem durumu yüklenemedi:', error);
      document.getElementById('api-status').textContent = 'Bağlantı Yok';
      document.getElementById('api-status').className = 'status-value error';
    }
  }

  // Model eğitimi başlat
  async function startTraining() {
    const btn = document.getElementById('train-btn');
    btn.disabled = true;
    btn.textContent = 'Eğitim Başlatılıyor...';
    
    try {
      const response = await fetch(`${API_BASE_URL}/api/training/start`, { method: 'POST' });
      const data = await response.json();
      
      if (data.success) {
        showTrainingProgress();
      }
    } catch (error) {
      console.error('Eğitim başlatılamadı:', error);
      showError('Eğitim başlatılamadı', 'Sunucuyla bağlantı kurulamadı. Lütfen internet bağlantınızı kontrol edin.');
    } finally {
      setTimeout(() => {
        btn.disabled = false;
        btn.textContent = '🤖 Modeli Eğit';
      }, 5000);
    }
  }

  // Eğitim ilerlemesini göster
  function showTrainingProgress() {
    const statusDiv = document.getElementById('training-status');
    statusDiv.style.display = 'block';
    statusDiv.className = 'training-status';
    
    const checkProgress = async () => {
      try {
        const response = await fetch(`${API_BASE_URL}/api/training/status`);
        const data = await response.json();
        
        document.getElementById('training-progress-text').textContent = `${data.progress}%`;
        document.getElementById('progress-fill').style.width = `${data.progress}%`;
        document.getElementById('training-message').textContent = data.progress < 100 ? 'Model eğitiliyor...' : 'Eğitim tamamlandı!';
        
        if (!data.is_training && data.progress === 100) {
          statusDiv.className = 'training-status training-complete';
          setTimeout(() => {
            statusDiv.style.display = 'none';
            loadMatches(); // Tahminleri yenile
          }, 3000);
        } else if (data.is_training) {
          setTimeout(checkProgress, 2000);
        }
      } catch (error) {
        console.error('Eğitim durumu kontrol edilemedi:', error);
      }
    };
    
    checkProgress();
  }

  // Verileri yenile
  async function refreshData() {
    const btn = document.getElementById('refresh-btn');
    btn.disabled = true;
    btn.textContent = 'Yenileniyor...';
    
    try {
      const response = await fetch(`${API_BASE_URL}/api/matches/refresh`, { method: 'POST' });
      const data = await response.json();
      
      if (data.success) {
        showSuccess('✅ Veriler başarıyla yenilendi!');
        loadMatches();
        loadSystemStatus();
      }
    } catch (error) {
      console.error('Veri yenileme hatası:', error);
      showError('Veri yenileme başarısız', 'Sunucuya bağlanılamıyor. Lütfen daha sonra tekrar deneyin.');
    } finally {
      btn.disabled = false;
      btn.textContent = '🔄 Verileri Yenile';
    }
  }

  // Başarı mesajı göster
  function showSuccess(message) {
    const existingAlert = document.querySelector('.success-alert');
    if (existingAlert) existingAlert.remove();
    
    const alert = document.createElement('div');
    alert.className = 'success-alert';
    alert.style.cssText = `
      position: fixed;
      top: 20px;
      right: 20px;
      background: linear-gradient(135deg, #00b894, #55efc4);
      color: #000;
      padding: 15px 20px;
      border-radius: 8px;
      font-weight: bold;
      z-index: 1000;
      animation: slideIn 0.3s ease;
    `;
    alert.textContent = message;
    
    document.body.appendChild(alert);
    
    setTimeout(() => {
      alert.remove();
    }, 3000);
  }

  // Maçları yükle
  async function loadMatches() {
    try {
      showLoading();
      const response = await fetch(`${API_BASE_URL}/api/predictions/upcoming?limit=1000`);
      
      if (!response.ok) {
        throw new Error(`Sunucu hatası: ${response.status} ${response.statusText}`);
      }
      
      const data = await response.json();
      
      if (data.success && data.predictions) {
        allPredictions = data.predictions.map(match => {
          match.country = detectCountryByTeamNames(match.home_team, match.away_team);
          return match;
        });
        
        buildCountryList();
        updateStats();
        currentPage = 1; // Sayfayı sıfırla
        applyFiltersAndSort();
        loadSystemStatus();
      } else {
        throw new Error('API yanıtı beklenen formatta değil');
      }
    } catch (err) {
      console.error('Maç yükleme hatası:', err);
      
      if (err.message.includes('Failed to fetch')) {
        showError('Bağlantı Hatası', 'Sunucuya bağlanılamıyor. Lütfen internet bağlantınızı kontrol edin.');
      } else if (err.message.includes('Sunucu hatası')) {
        showError('Sunucu Hatası', 'Sunucu geçici olarak hizmet veremiyor. Lütfen daha sonra tekrar deneyin.');
      } else {
        showError('Veri Yükleme Hatası', err.message);
      }
    }
  }

  // Ülke listesini oluştur
  function buildCountryList() {
    const countryCounts = {};
    allPredictions.forEach(m => {
      const country = m.country || "🌍 Diğer Ülkeler";
      countryCounts[country] = (countryCounts[country] || 0) + 1;
    });
    
    const priorityCountries = ["🇹🇷 Türkiye", "🏴󠁧󠁢󠁥󠁮󠁧󠁿 İngiltere", "🇪🇸 İspanya", "🇮🇹 İtalya", "🇩🇪 Almanya", "🇫🇷 Fransa", "🇳🇱 Hollanda", "🇵🇹 Portekiz"];
    const sortedCountries = Object.keys(countryCounts).sort((a, b) => {
      const aIndex = priorityCountries.indexOf(a);
      const bIndex = priorityCountries.indexOf(b);
      if (aIndex !== -1 && bIndex !== -1) return aIndex - bIndex;
      if (aIndex !== -1) return -1;
      if (bIndex !== -1) return 1;
      return countryCounts[b] - countryCounts[a];
    });
    
    let html = `<div class="league-item ${selectedLeague === 'all' ? 'active' : ''}" onclick="selectLeague('all', event)">
                    🌍 <span class="league-name">Tüm Ülkeler</span>
                    <span class="league-count">${allPredictions.length}</span></div>`;
    
    sortedCountries.forEach(country => {
      html += `<div class="league-item ${selectedLeague === country ? 'active' : ''}" onclick="selectLeague('${country}', event)">
                  <span class="league-name">${country}</span>
                  <span class="league-count">${countryCounts[country]}</span></div>`;
    });
    
    document.getElementById('league-list').innerHTML = html;
  }

  // Ülke seçimi
  function selectLeague(league, event) {
    selectedLeague = String(league);
    document.querySelectorAll('.league-item').forEach(x => x.classList.remove('active'));
    event.currentTarget.classList.add('active');
    currentPage = 1; // Sayfayı sıfırla
    applyFiltersAndSort();
  }

  // Filtreleme
  function filterMatches(filter, event) {
    currentFilter = filter;
    document.querySelectorAll('.filter-btn').forEach(x => x.classList.remove('active'));
    event.currentTarget.classList.add('active');
    currentPage = 1; // Sayfayı sıfırla
    applyFiltersAndSort();
  }

  // Sıralama
  function sortMatches(sort, event) {
    currentSort = sort;
    document.querySelectorAll('.sort-btn').forEach(x => x.classList.remove('active'));
    event.currentTarget.classList.add('active');
    applyFiltersAndSort();
  }

  // Güven değerini normalize et
  function normalizeConfidence(c) { 
    return c <= 1 ? c * 100 : c; 
  }

  // Filtre ve sıralama uygula
  function applyFiltersAndSort() {
    let filtered = [...allPredictions];
    
    // Ülke filtresi
    if (selectedLeague !== 'all') {
      filtered = filtered.filter(m => m.country === selectedLeague);
    }
    
    // Filtreleme
    if (currentFilter === 'high-confidence') {
      filtered = filtered.filter(m => normalizeConfidence(m.ai_prediction?.confidence || 0) >= 70);
    } else if (currentFilter === 'value-bets') {
      filtered = filtered.filter(m => {
        const valueBet = m.ai_prediction?.value_bet;
        return valueBet && valueBet.value_index >= 0.1;
      });
    } else if (currentFilter === 'strong-bets') {
      filtered = filtered.filter(m => {
        const confidence = normalizeConfidence(m.ai_prediction?.confidence || 0);
        const valueBet = m.ai_prediction?.value_bet;
        return confidence >= 65 && valueBet && valueBet.value_index >= 0.08;
      });
    }
    
    // Sıralama
    if (currentSort === 'confidence') {
      filtered.sort((a, b) => normalizeConfidence(b.ai_prediction?.confidence || 0) - normalizeConfidence(a.ai_prediction?.confidence || 0));
    } else if (currentSort === 'time') {
      filtered.sort((a, b) => {
        const dateA = a.date ? new Date(a.date + 'T' + (a.time || '20:00')) : new Date(0);
        const dateB = b.date ? new Date(b.date + 'T' + (b.time || '20:00')) : new Date(0);
        return dateA - dateB;
      });
    } else if (currentSort === 'value') {
      filtered.sort((a, b) => {
        const valueA = a.ai_prediction?.value_bet?.value_index || 0;
        const valueB = b.ai_prediction?.value_bet?.value_index || 0;
        return valueB - valueA;
      });
    }
    
    updateStats(filtered);
    displayMatches(filtered);
  }

  // Sayfa değiştirme
  function changePage(direction) {
    const totalPages = Math.ceil(currentFilteredMatches.length / matchesPerPage);
    currentPage += direction;
    
    if (currentPage < 1) currentPage = 1;
    if (currentPage > totalPages) currentPage = totalPages;
    
    displayMatches(currentFilteredMatches);
  }

  // İstatistikleri güncelle
  function updateStats(filtered = allPredictions) {
    document.getElementById('total-matches').textContent = filtered.length;
    
    const highConfidence = filtered.filter(m => normalizeConfidence(m.ai_prediction?.confidence || 0) >= 70).length;
    document.getElementById('high-confidence').textContent = highConfidence;
    
    const valueBets = filtered.filter(m => {
      const valueBet = m.ai_prediction?.value_bet;
      return valueBet && valueBet.value_index >= 0.1;
    }).length;
    document.getElementById('value-bets').textContent = valueBets;
  }

  let currentFilteredMatches = [];

  // Maçları göster
  function displayMatches(matches) {
    const area = document.getElementById('content-area');
    const pagination = document.getElementById('pagination');
    
    currentFilteredMatches = matches;
    
    if (matches.length === 0) { 
      area.innerHTML = `<div class="loading">Bu ülke/filtre için maç bulunamadı</div>`; 
      pagination.style.display = 'none';
      return; 
    }

    // Pagination
    const totalPages = Math.ceil(matches.length / matchesPerPage);
    const startIndex = (currentPage - 1) * matchesPerPage;
    const endIndex = startIndex + matchesPerPage;
    const paginatedMatches = matches.slice(startIndex, endIndex);

    // Pagination kontrollerini güncelle
    document.getElementById('page-info').textContent = `Sayfa ${currentPage} / ${totalPages}`;
    document.getElementById('prev-btn').disabled = currentPage === 1;
    document.getElementById('next-btn').disabled = currentPage === totalPages;
    
    if (totalPages > 1) {
      pagination.style.display = 'flex';
    } else {
      pagination.style.display = 'none';
    }

    const grouped = {};
    paginatedMatches.forEach(m => {
      const country = m.country || "🌍 Diğer Ülkeler";
      if (!grouped[country]) grouped[country] = [];
      grouped[country].push(m);
    });

    const priorityCountries = ["🇹🇷 Türkiye", "🏴󠁧󠁢󠁥󠁮󠁧󠁿 İngiltere", "🇪🇸 İspanya", "🇮🇹 İtalya", "🇩🇪 Almanya", "🇫🇷 Fransa", "🇳🇱 Hollanda", "🇵🇹 Portekiz"];
    const sortedCountries = Object.keys(grouped).sort((a, b) => {
      const aIndex = priorityCountries.indexOf(a);
      const bIndex = priorityCountries.indexOf(b);
      if (aIndex !== -1 && bIndex !== -1) return aIndex - bIndex;
      if (aIndex !== -1) return -1;
      if (bIndex !== -1) return 1;
      return a.localeCompare(b);
    });

    let html = '';
    sortedCountries.forEach(country => {
      const maclar = grouped[country];
      
      html += `<div class="league-section">
                <div class="league-header">
                  <div class="league-title">${country}</div>
                  <div class="league-match-count">${maclar.length} maç</div>
                </div>
                <div class="match-table-container">
                  <table>
                    <thead>
                      <tr>
                        <th>Tarih/Saat</th>
                        <th>Maç & Tahmin</th>
                        <th>1</th>
                        <th>X</th>
                        <th>2</th>
                        <th>Güven</th>
                      </tr>
                    </thead>
                    <tbody>`;
      
      maclar.forEach(m => {
        const p = m.ai_prediction || {};
        const result = p.prediction || 'X';
        const confidence = normalizeConfidence(p.confidence || 0);
        const odds1 = m.odds?.['1'] || 2.0;
        const oddsX = m.odds?.X || 3.0;
        const odds2 = m.odds?.['2'] || 3.5;
        const valueBet = p.value_bet || {};
        const riskLevel = p.risk_level || 'MEDIUM';
        
        // Güven seviyesi için CSS class
        let confidenceClass = 'confidence-low';
        if (confidence >= 70) confidenceClass = 'confidence-high';
        else if (confidence >= 55) confidenceClass = 'confidence-medium';
        
        // Risk seviyesi için CSS class
        let riskClass = 'risk-medium';
        if (riskLevel === 'LOW') riskClass = 'risk-low';
        else if (riskLevel === 'HIGH') riskClass = 'risk-high';
        
        html += `<tr>
                   <td class="match-time">
                     ${formatDate(m.date)}<br>${formatTime(m.time)}
                   </td>
                   <td class="match-info">
                     <div class="home-team">${m.home_team}</div>
                     <div class="away-team">${m.away_team}</div>
                     <div class="prediction-details">
                       <span class="${riskClass}">${p.recommendation || '⚠️ CONSIDER'}</span>
                       ${valueBet.rating === 'EXCELLENT' || valueBet.rating === 'GOOD' ? 
                         '<span class="value-bet-badge">💰</span>' : ''}
                     </div>
                   </td>
                   <td class="odds-cell">
                     <div class="odds-box ${result === '1' ? 'predicted' : ''}">
                       ${odds1.toFixed(2)}
                       ${valueBet.rating === 'EXCELLENT' && result === '1' ? '<div class="value-bet-badge">💰</div>' : ''}
                     </div>
                   </td>
                   <td class="odds-cell">
                     <div class="odds-box ${result === 'X' ? 'predicted' : ''}">
                       ${oddsX.toFixed(2)}
                       ${valueBet.rating === 'EXCELLENT' && result === 'X' ? '<div class="value-bet-badge">💰</div>' : ''}
                     </div>
                   </td>
                   <td class="odds-cell">
                     <div class="odds-box ${result === '2' ? 'predicted' : ''}">
                       ${odds2.toFixed(2)}
                       ${valueBet.rating === 'EXCELLENT' && result === '2' ? '<div class="value-bet-badge">💰</div>' : ''}
                     </div>
                   </td>
                   <td style="text-align:center;">
                     <div style="font-weight:bold;color:#ffd700;">%${confidence.toFixed(1)}</div>
                     <div class="confidence-bar">
                       <div class="confidence-fill ${confidenceClass}" style="width: ${confidence}%"></div>
                     </div>
                     <div class="prediction-details">${p.score_prediction || '1-1'}</div>
                   </td>
                 </tr>`;
      });
      
      html += `</tbody></table></div></div>`;
    });

    area.innerHTML = html;
  }

  // Hata mesajı göster
  function showError(title, message) {
    const area = document.getElementById('content-area');
    area.innerHTML = `
      <div class="error-container">
        <div class="error-title">❌ ${title}</div>
        <div class="error-details">${message}</div>
        <button class="action-btn refresh" onclick="loadMatches()">Tekrar Dene</button>
      </div>
    `;
    document.getElementById('pagination').style.display = 'none';
  }

  // Yükleme göster
  function showLoading() { 
    const area = document.getElementById('content-area');
    area.innerHTML = '<div class="loading"><div class="loading-spinner"></div>🤖 AI tahminleri yükleniyor...</div>'; 
    document.getElementById('pagination').style.display = 'none';
  }

  // Sayfa yüklendiğinde
  window.addEventListener('load', () => { 
    loadSystemStatus();
    loadMatches();
    
    // Otomatik yenileme
    setInterval(loadMatches, 300000); // 5 dakika
    setInterval(loadSystemStatus, 60000); // 1 dakika
    
    // İlk eğitim durumunu kontrol et
    setTimeout(() => {
      fetch(`${API_BASE_URL}/api/training/status`)
        .then(response => response.json())
        .then(data => {
          if (data.is_training) {
            showTrainingProgress();
          }
        })
        .catch(console.error);
    }, 2000);
  });

  // CSS animation için
  const style = document.createElement('style');
  style.textContent = `
    @keyframes slideIn {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }
  `;
  document.head.appendChild(style);
</script>
</body>
</html>
