<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>Predicta Europe ML v2</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    :root {
      --bg:#0f172a; --card:#111827; --muted:#94a3b8; --accent:#22c55e; --primary:#60a5fa;
    }
    body {
      margin:0; font-family:Inter, system-ui, Arial; background:var(--bg); color:#e5e7eb;
    }
    header {
      padding:20px; border-bottom:1px solid #1f2937; display:flex; align-items:center; gap:16px;
    }
    header h1 { font-size:20px; margin:0; }
    header button {
      background:#1f2937; border:1px solid #374151; color:#e5e7eb; border-radius:8px; padding:8px 12px; cursor:pointer;
    }
    main {
      max-width:1200px; margin:0 auto; padding:24px; display:grid; grid-template-columns: 420px 1fr; gap:24px;
    }
    .card {
      background:var(--card); border:1px solid #1f2937; border-radius:16px; padding:16px;
    }
    label {
      display:block; font-size:12px; color:var(--muted); margin:12px 0 4px;
    }
    input, select, textarea {
      width:100%; background:#0b1220; color:#e5e7eb; border:1px solid #1f2937; border-radius:8px; padding:10px;
    }
    button.primary {
      background:linear-gradient(90deg, #2563eb, #22c55e);
      border:none; border-radius:10px; padding:10px 14px; color:white; cursor:pointer;
    }
    table {
      width:100%; border-collapse: collapse; margin-top:10px;
    }
    th, td { border-bottom:1px solid #1f2937; padding:8px; font-size:14px; text-align:left; }
    pre { background:#0b1220; border:1px solid #1f2937; border-radius:10px; padding:10px; overflow:auto; }
  </style>
</head>
<body>
  <header>
    <h1>⚽ Predicta Europe ML v2</h1>
    <button id="btn-train">Modeli Eğit</button>
    <button id="btn-reload">Modelleri Yeniden Yükle</button>
    <span id="status" style="font-size:12px;color:#94a3b8;"></span>
  </header>

  <main>
    <section class="card">
      <label>Ülke</label>
      <select id="country"></select>
      <label>Lig</label>
      <select id="league"></select>

      <label>Ev Sahibi</label>
      <input id="home" placeholder="Galatasaray">
      <label>Deplasman</label>
      <input id="away" placeholder="Fenerbahçe">

      <label>Oranlar (1, X, 2)</label>
      <div style="display:flex;gap:6px;">
        <input id="o1" value="2.05"><input id="ox" value="3.30"><input id="o2" value="3.40">
      </div>

      <button class="primary" id="btn-predict" style="margin-top:10px;">Tahmin Al</button>
      <pre id="output"></pre>
    </section>

    <section class="card">
      <h3>Sonuçlar</h3>
      <table>
        <thead><tr><th>Maç</th><th>MS</th><th>Skor</th><th>Güven</th><th>Value</th></tr></thead>
        <tbody id="tableBody"></tbody>
      </table>
      <pre id="log"></pre>
    </section>
  </main>

<script>
const API_BASE = "https://predicta-production.up.railway.app"; // 🔁 kendi Railway URL'inle değiştir!

const $ = id => document.getElementById(id);

function setStatus(msg){ $("status").textContent = msg; }
function log(msg){ $("log").textContent += msg + "\\n"; }

async function loadLeagues(){
  setStatus("Ligler yükleniyor...");
  const res = await fetch(API_BASE + "/api/leagues");
  const data = await res.json();
  const list = data.items || [];
  const countrySel = $("country");
  const leagueSel = $("league");
  countrySel.innerHTML = "";
  list.forEach(c=>{
    const opt=document.createElement("option");
    opt.value=c.country; opt.textContent=c.country;
    countrySel.appendChild(opt);
  });
  countrySel.onchange=()=>{
    const selected=list.find(x=>x.country===countrySel.value);
    leagueSel.innerHTML="";
    (selected?.leagues||[]).forEach(l=>{
      const o=document.createElement("option");
      o.value=l.name; o.textContent=l.name; leagueSel.appendChild(o);
    });
  };
  countrySel.dispatchEvent(new Event("change"));
  setStatus("Ligler yüklendi.");
}

async function predictOne(){
  const payload={
    home_team:$("home").value.trim(),
    away_team:$("away").value.trim(),
    league:$("league").value.trim(),
    odds:{"1":parseFloat($("o1").value),"X":parseFloat($("ox").value),"2":parseFloat($("o2").value)}
  };
  setStatus("Tahmin yapılıyor...");
  const res = await fetch(API_BASE+"/api/predict",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(payload)});
  const data = await res.json();
  $("output").textContent = JSON.stringify(data, null, 2);
  setStatus("Tahmin tamamlandı.");
  const tr = document.createElement("tr");
  tr.innerHTML = `<td>${payload.home_team} - ${payload.away_team}</td>
                  <td>${data.prediction}</td>
                  <td>${data.score_prediction||"-"}</td>
                  <td>${data.confidence?.toFixed?.(1)||data.confidence}%</td>
                  <td>${data.value_bet?.value_index?.toFixed?.(3)||"-"}</td>`;
  $("tableBody").prepend(tr);
}

async function trainModel(){
  setStatus("Eğitim başlatıldı...");
  const res = await fetch(API_BASE+"/api/training/start",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({top_scores_k:20})});
  const data = await res.json();
  setStatus("Eğitim tamamlandı.");
  alert("Eğitim tamamlandı!\\n" + JSON.stringify(data,null,2));
}

async function reloadModels(){
  setStatus("Modeller yeniden yükleniyor...");
  await fetch(API_BASE+"/api/reload");
  setStatus("Modeller yüklendi.");
}

$("btn-predict").onclick=predictOne;
$("btn-train").onclick=trainModel;
$("btn-reload").onclick=reloadModels;

loadLeagues();
</script>
</body>
</html>
